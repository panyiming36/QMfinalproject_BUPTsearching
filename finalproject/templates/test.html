<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BUPT Linked Data æµ‹è¯•ç•Œé¢</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            color: white;
            margin-bottom: 40px;
            padding: 20px;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }
        
        .tabs {
            display: flex;
            background: white;
            border-radius: 10px 10px 0 0;
            overflow: hidden;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }
        
        .tab {
            flex: 1;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            background: #f8f9fa;
            border: none;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .tab:hover {
            background: #e9ecef;
        }
        
        .tab.active {
            background: white;
            color: #667eea;
            box-shadow: inset 0 -3px 0 #667eea;
        }
        
        .content {
            background: white;
            border-radius: 0 0 10px 10px;
            padding: 30px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            min-height: 500px;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .search-box {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        input[type="text"], textarea {
            flex: 1;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        
        input[type="text"]:focus, textarea:focus {
            outline: none;
            border-color: #667eea;
        }
        
        button {
            padding: 12px 30px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s;
        }
        
        button:hover {
            transform: translateY(-2px);
        }
        
        button:active {
            transform: translateY(0);
        }
        
        .results {
            margin-top: 20px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            overflow: hidden;
        }
        
        .result-header {
            background: #f8f9fa;
            padding: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .result-item {
            padding: 15px;
            border-bottom: 1px solid #e0e0e0;
            transition: background 0.2s;
            cursor: pointer;
        }
        
        .result-item:hover {
            background: #f9f9f9;
        }
        
        .result-item:last-child {
            border-bottom: none;
        }
        
        .result-title {
            font-weight: 600;
            color: #333;
            margin-bottom: 5px;
        }
        
        .result-meta {
            font-size: 14px;
            color: #666;
            display: flex;
            gap: 15px;
        }
        
        .badge {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
        }
        
        .badge.paper { background: #4CAF50; color: white; }
        .badge.author { background: #2196F3; color: white; }
        .badge.organization { background: #FF9800; color: white; }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .stat-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
        }
        
        .stat-value {
            font-size: 2em;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 10px;
        }
        
        .stat-label {
            color: #666;
        }
        
        .sparql-editor {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        textarea {
            height: 200px;
            font-family: monospace;
            font-size: 14px;
        }
        
        .resource-details {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
        }
        
        .loading {
            text-align: center;
            padding: 20px;
            color: #666;
        }
        
        .error {
            background: #ffebee;
            color: #c62828;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
        }
        
        .property-list {
            margin-top: 15px;
        }
        
        .property-item {
            padding: 10px;
            border-bottom: 1px solid #eee;
        }
        
        .property-name {
            font-weight: 600;
            color: #333;
        }
        
        .property-value {
            color: #666;
            word-break: break-all;
        }
        
        .uri-link {
            color: #667eea;
            text-decoration: none;
        }
        
        .uri-link:hover {
            text-decoration: underline;
        }
        
        /* æ·»åŠ çš„ç±»æ¥æ§åˆ¶æ˜¾ç¤º/éšè— */
        .hidden {
            display: none !important;
        }
        
        .visible {
            display: block;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ“š BUPT Linked Data ç³»ç»Ÿ</h1>
            <p>çŸ¥è¯†å›¾è°±æœç´¢ä¸æŸ¥è¯¢æµ‹è¯•ç•Œé¢</p>
        </div>
        
        <div class="tabs">
            <button class="tab active" onclick="switchTab('search')">ğŸ” æœç´¢</button>
            <button class="tab" onclick="switchTab('resource')">ğŸ“„ èµ„æºè¯¦æƒ…</button>
            <button class="tab" onclick="switchTab('stats')">ğŸ“Š ç»Ÿè®¡</button>
            <button class="tab" onclick="switchTab('sparql')">ğŸ”„ SPARQLæŸ¥è¯¢</button>
        </div>
        
        <div class="content">
            <!-- æœç´¢æ ‡ç­¾é¡µ -->
            <div id="search" class="tab-content active">
                <h2>æœç´¢ç ”ç©¶æ•°æ®</h2>
                <div class="search-box">
                    <input type="text" id="searchInput" placeholder="è¾“å…¥æœç´¢å…³é”®è¯ (å¦‚: äººå·¥æ™ºèƒ½ã€åŒ—äº¬é‚®ç”µå¤§å­¦ã€5G)">
                    <button onclick="performSearch()">æœç´¢</button>
                </div>
                
                <div id="searchResults">
                    <div class="loading hidden" id="searchLoading">æœç´¢ä¸­...</div>
                    <div class="error hidden" id="searchError"></div>
                    <div class="results" id="resultsList"></div>
                </div>
            </div>
            
            <!-- èµ„æºè¯¦æƒ…æ ‡ç­¾é¡µ -->
            <div id="resource" class="tab-content">
                <h2>æŸ¥çœ‹èµ„æºè¯¦æƒ…</h2>
                <div class="search-box">
                    <input type="text" id="resourceInput" placeholder="è¾“å…¥èµ„æºURI (å¦‚: http://bupt.edu.cn/research/paper_0014)">
                    <button onclick="getResource()">è·å–è¯¦æƒ…</button>
                </div>
                
                <div id="resourceResults">
                    <div class="loading hidden" id="resourceLoading">åŠ è½½ä¸­...</div>
                    <div class="error hidden" id="resourceError"></div>
                    <div id="resourceDetails"></div>
                </div>
            </div>
            
            <!-- ç»Ÿè®¡æ ‡ç­¾é¡µ -->
            <div id="stats" class="tab-content">
                <h2>æ•°æ®ç»Ÿè®¡</h2>
                <button onclick="loadStats()">åŠ è½½ç»Ÿè®¡ä¿¡æ¯</button>
                
                <div id="statsResults">
                    <div class="loading hidden" id="statsLoading">åŠ è½½ä¸­...</div>
                    <div class="error hidden" id="statsError"></div>
                    <div class="stats-grid" id="statsGrid"></div>
                </div>
            </div>
            
            <!-- SPARQLæŸ¥è¯¢æ ‡ç­¾é¡µ -->
            <div id="sparql" class="tab-content">
                <h2>SPARQLæŸ¥è¯¢</h2>
                <div class="sparql-editor">
                    <textarea id="sparqlQuery" placeholder="è¾“å…¥SPARQLæŸ¥è¯¢è¯­å¥...">
PREFIX schema: &lt;http://schema.org/&gt;
PREFIX foaf: &lt;http://xmlns.com/foaf/0.1/&gt;
PREFIX dcterms: &lt;http://purl.org/dc/terms/&gt;

SELECT ?paper ?title ?author ?authorName WHERE {
  ?paper a schema:ScholarlyArticle .
  ?paper schema:name ?title .
  ?paper schema:author ?author .
  ?author foaf:name ?authorName .
} LIMIT 10</textarea>
                    <div style="display: flex; gap: 10px;">
                        <button onclick="executeSparql()">æ‰§è¡ŒæŸ¥è¯¢</button>
                        <button onclick="loadExample()" style="background: #6c757d;">åŠ è½½ç¤ºä¾‹</button>
                    </div>
                </div>
                
                <div id="sparqlResults">
                    <div class="loading hidden" id="sparqlLoading">æŸ¥è¯¢ä¸­...</div>
                    <div class="error hidden" id="sparqlError"></div>
                    <div class="results" id="sparqlResultList"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:5000';
        
        // å·¥å…·å‡½æ•°ï¼šæ˜¾ç¤º/éšè—å…ƒç´ 
        function show(elementId) {
            document.getElementById(elementId).classList.remove('hidden');
            document.getElementById(elementId).classList.add('visible');
        }
        
        function hide(elementId) {
            document.getElementById(elementId).classList.remove('visible');
            document.getElementById(elementId).classList.add('hidden');
        }
        
        // æ ‡ç­¾é¡µåˆ‡æ¢
        function switchTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
        }
        
        // æœç´¢åŠŸèƒ½
        async function performSearch() {
            const keyword = document.getElementById('searchInput').value.trim();
            if (!keyword) {
                alert('è¯·è¾“å…¥æœç´¢å…³é”®è¯');
                return;
            }
            
            show('searchLoading');
            hide('searchError');
            document.getElementById('resultsList').innerHTML = '';
            
            try {
                const response = await fetch(`${API_BASE}/search?q=${encodeURIComponent(keyword)}`);
                const data = await response.json();
                
                if (data.error) {
                    throw new Error(data.error);
                }
                
                hide('searchLoading');
                
                if (data.count === 0) {
                    document.getElementById('resultsList').innerHTML = `
                        <div class="result-item">
                            <div class="result-title">æœªæ‰¾åˆ°ç›¸å…³ç»“æœ</div>
                            <div class="result-meta">å°è¯•ä½¿ç”¨å…¶ä»–å…³é”®è¯æœç´¢</div>
                        </div>
                    `;
                    return;
                }
                
                let resultsHtml = `
                    <div class="result-header">
                        <div>æ‰¾åˆ° ${data.count} ä¸ªç»“æœ</div>
                        <div>å…³é”®è¯: "${data.query}"</div>
                    </div>
                `;
                
                data.results.forEach(result => {
                    resultsHtml += `
                        <div class="result-item" onclick="viewResource('${result.uri}')">
                            <div class="result-title">${result.label}</div>
                            <div class="result-meta">
                                <span class="badge ${result.type}">${result.type}</span>
                                <span>${result.uri}</span>
                            </div>
                        </div>
                    `;
                });
                
                document.getElementById('resultsList').innerHTML = resultsHtml;
                
            } catch (error) {
                hide('searchLoading');
                show('searchError');
                document.getElementById('searchError').innerText = `é”™è¯¯: ${error.message}`;
            }
        }
        
        // æŸ¥çœ‹èµ„æºè¯¦æƒ…
        async function getResource() {
            const uri = document.getElementById('resourceInput').value.trim();
            if (!uri) {
                alert('è¯·è¾“å…¥èµ„æºURI');
                return;
            }
            
            show('resourceLoading');
            hide('resourceError');
            document.getElementById('resourceDetails').innerHTML = '';
            
            try {
                const response = await fetch(`${API_BASE}/resource?uri=${encodeURIComponent(uri)}`);
                const data = await response.json();
                
                if (data.error) {
                    throw new Error(data.error);
                }
                
                hide('resourceLoading');
                
                let detailsHtml = `
                    <div class="resource-details">
                        <h3>èµ„æºè¯¦æƒ…</h3>
                        <p><strong>URI:</strong> <a href="${data.uri}" target="_blank" class="uri-link">${data.uri}</a></p>
                        ${data.types.length > 0 ? `<p><strong>ç±»å‹:</strong> ${data.types.join(', ')}</p>` : ''}
                        <p><strong>å±æ€§æ•°é‡:</strong> ${data.property_count}</p>
                        
                        <h4>å±æ€§åˆ—è¡¨:</h4>
                        <div class="property-list">
                `;
                
                data.properties.forEach(prop => {
                    const valueHtml = prop.is_uri 
                        ? `<a href="javascript:void(0)" onclick="viewResource('${prop.value}')" class="uri-link">${prop.value}</a>`
                        : prop.value;
                    
                    detailsHtml += `
                        <div class="property-item">
                            <div class="property-name">${prop.property}</div>
                            <div class="property-value">${valueHtml}</div>
                        </div>
                    `;
                });
                
                detailsHtml += `
                        </div>
                    </div>
                `;
                
                document.getElementById('resourceDetails').innerHTML = detailsHtml;
                
            } catch (error) {
                hide('resourceLoading');
                show('resourceError');
                document.getElementById('resourceError').innerText = `é”™è¯¯: ${error.message}`;
            }
        }
        
        // æŸ¥çœ‹èµ„æºï¼ˆä»URIï¼‰
        function viewResource(uri) {
            document.getElementById('resourceInput').value = uri;
            switchTab('resource');
            setTimeout(() => getResource(), 100);
        }
        
        // åŠ è½½ç»Ÿè®¡ä¿¡æ¯
        async function loadStats() {
            show('statsLoading');
            hide('statsError');
            document.getElementById('statsGrid').innerHTML = '';
            
            try {
                const response = await fetch(`${API_BASE}/stats`);
                const data = await response.json();
                
                hide('statsLoading');
                
                let statsHtml = '';
                for (const [key, value] of Object.entries(data)) {
                    let label = key;
                    if (key === 'papers') label = 'è®ºæ–‡æ•°é‡';
                    else if (key === 'authors') label = 'ä½œè€…æ•°é‡';
                    else if (key === 'organizations') label = 'ç»„ç»‡æ•°é‡';
                    else if (key === 'total_triples') label = 'ä¸‰å…ƒç»„æ€»æ•°';
                    
                    statsHtml += `
                        <div class="stat-card">
                            <div class="stat-value">${value}</div>
                            <div class="stat-label">${label}</div>
                        </div>
                    `;
                }
                
                document.getElementById('statsGrid').innerHTML = statsHtml;
                
            } catch (error) {
                hide('statsLoading');
                show('statsError');
                document.getElementById('statsError').innerText = `é”™è¯¯: ${error.message}`;
            }
        }
        
        // æ‰§è¡ŒSPARQLæŸ¥è¯¢
        async function executeSparql() {
            const query = document.getElementById('sparqlQuery').value.trim();
            if (!query) {
                alert('è¯·è¾“å…¥SPARQLæŸ¥è¯¢è¯­å¥');
                return;
            }
            
            show('sparqlLoading');
            hide('sparqlError');
            document.getElementById('sparqlResultList').innerHTML = '';
            
            try {
                const formData = new FormData();
                formData.append('query', query);
                
                const response = await fetch(`${API_BASE}/sparql`, {
                    method: 'POST',
                    body: new URLSearchParams({ query: query })
                });
                
                const data = await response.json();
                
                if (data.error) {
                    throw new Error(data.error);
                }
                
                hide('sparqlLoading');
                
                let resultsHtml = `
                    <div class="result-header">
                        <div>æŸ¥è¯¢ç»“æœ (${data.count} æ¡)</div>
                        <div>æŸ¥è¯¢è¯­å¥å·²æ‰§è¡Œ</div>
                    </div>
                `;
                
                if (data.count === 0) {
                    resultsHtml += `
                        <div class="result-item">
                            <div class="result-title">æ— ç»“æœ</div>
                            <div class="result-meta">æŸ¥è¯¢æœªè¿”å›ä»»ä½•æ•°æ®</div>
                        </div>
                    `;
                } else {
                    data.results.forEach((row, index) => {
                        resultsHtml += `
                            <div class="result-item">
                                <div class="result-title">ç»“æœ #${index + 1}</div>
                                <div class="result-meta">
                        `;
                        
                        for (const [key, value] of Object.entries(row)) {
                            resultsHtml += `
                                <div><strong>${key}:</strong> ${value}</div>
                            `;
                        }
                        
                        resultsHtml += `
                                </div>
                            </div>
                        `;
                    });
                }
                
                document.getElementById('sparqlResultList').innerHTML = resultsHtml;
                
            } catch (error) {
                hide('sparqlLoading');
                show('sparqlError');
                document.getElementById('sparqlError').innerText = `é”™è¯¯: ${error.message}`;
            }
        }
        
        // åŠ è½½SPARQLç¤ºä¾‹
        function loadExample() {
            const example = `PREFIX schema: <http://schema.org/>
PREFIX foaf: <http://xmlns.com/foaf/0.1/>
PREFIX dcterms: <http://purl.org/dc/terms/>

SELECT ?paper ?title ?author ?authorName WHERE {
  ?paper a schema:ScholarlyArticle .
  ?paper schema:name ?title .
  ?paper schema:author ?author .
  ?author foaf:name ?authorName .
} LIMIT 10`;
            
            document.getElementById('sparqlQuery').value = example;
        }
        
        // æœç´¢æ¡†å›è½¦äº‹ä»¶
        document.getElementById('searchInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                performSearch();
            }
        });
        
        // èµ„æºURIè¾“å…¥æ¡†å›è½¦äº‹ä»¶
        document.getElementById('resourceInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                getResource();
            }
        });
        
        // é¡µé¢åŠ è½½æ—¶æ˜¾ç¤ºæ¬¢è¿ä¿¡æ¯
        window.onload = function() {
            console.log('BUPT Linked Data æµ‹è¯•ç•Œé¢å·²åŠ è½½');
            console.log('åç«¯APIåœ°å€:', API_BASE);
            loadStats();
        };
    </script>
</body>
</html>